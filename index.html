<!DOCTYPE html>
<html>
<head>
  <title>Click Map to Send Coordinates</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
  <style>
    #map { height: 90vh; width: 100%; }
    #result { padding: 10px; font-family: Arial; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="result">Click on the map to send coordinates to Python.</div>

  <script>
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: { lat: 12.9716, lng: 77.5946 }, // Bengaluru
      });

      map.addListener("click", async function (e) {
        const lat = e.latLng.lat();
        const lng = e.latLng.lng();
        
        document.getElementById("result").innerHTML = "Processing...";

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `Sending coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}...`;

        try {
          // Send to Flask
          const response = await fetch("http://localhost:5000/process-coordinates", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ lat, lng }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          } 

          const data = await response.json();
          resultDiv.innerHTML = `<span class="success">${data.message}</span>`;

          let scoresHtml = '<h3>Location Scores:</h3>';
            if (data.scores) {
                for (const [key, value] of Object.entries(data.scores)) {
                const stars = '★'.repeat(Math.max(0, Math.min(5, value))); // Limit to 5 stars
                const emptyStars = '☆'.repeat(5 - Math.max(0, Math.min(5, value)));
                scoresHtml += `<div class="score-item">
                    <span class="score-label">${key}:</span> 
                    <span class="stars">${stars}${emptyStars}</span> 
                    <span class="score-value">(${value})</span>
                </div>`;
                }
            } 

            document.getElementById("result").innerHTML = scoresHtml;

        } catch (error) {
          console.error('Error:', error);
          resultDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`;
        }
      });
    }
  </script>

  <!-- Replace YOUR_API_KEY with your actual Google Maps API key -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0xpclQoMTs9FgXsyk1zvXYdiFfJb8YXM&callback=initMap">
  </script>
</body>
</html>